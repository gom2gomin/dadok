<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.choongang.s202350103.AttendanceMapper">
	<select id="shTotalAtt" resultType="int">
		Select Count(*) From attendance
	</select>
	
	<select id="shEventList" parameterType="Attendance" resultType="Attendance">
		<![CDATA[
		Select * From (Select ROWNUM rn, a.* From 
		(SELECT a_num, a_title, a_sdate, a_edate, a_image FROM attendance
		UNION
		SELECT q_num, q_title, q_sdate, q_edate, q_image FROM quiz
		order by a_num desc
		)a) 
		Where 	rn >= #{start}
		and		rn <= #{end}
		]]>
	</select>
	
	<select id="shDivideAttNum" parameterType="int" resultType="int">
		Select a_num From attendance Where a_num=#{eNum}
	</select>
	
	<select id="shAttendance" parameterType="int" resultType="Attendance">
		Select * From attendance Where a_num=#{eNum}
	</select>
	
	<select id="shStartMonth" parameterType="int" resultType="int">
		Select substr(a_sdate,6,2) From attendance Where a_num=#{eNum}
	</select>
	
	<select id="shStartYear" parameterType="int" resultType="int">
		Select substr(a_sdate,1,4) From attendance Where a_num=#{eNum}
	</select>
	
	<insert id="shCreateAtt" parameterType="attendance">
		Insert into attendance Values (event_num_seq.nextval, #{a_title}, #{a_sdate},#{a_edate},#{a_image},#{a_point},#{a_add},#{a_addpoint})
	</insert>
	
	<select id="shBoEventList" resultType="Attendance">
	<![CDATA[
		Select rownum rn, a.* 
		From
		 (
		 Select a_title, a_num, a_sdate, a_edate, a_point, a_add
		 From attendance
		 Union
		 Select q_title, q_num, q_sdate, q_edate, q_point, null As a_add
		 From Quiz
		 Order by a_num
		 ) a
		Order by rn DESC
	]]>
	</select>
	
	<update id="shUpdateAttendance" parameterType="Attendance">
		Update Attendance
		Set 
		a_title = #{a_title},
		a_sdate = #{a_sdate},
		a_edate = #{a_edate},
		a_image = #{a_image},
		a_point = #{a_point},
		a_add   = #{a_add},
		a_addpoint = #{a_addpoint}
		Where a_num = #{a_num}
	</update>
	
	<select id="shBoSearchEvent" parameterType="Attendance" resultType="Attendance">
		<![CDATA[
		Select rownum rn, a.* 
		From
		 (
		 Select a_title, a_num, a_sdate, a_edate, a_point, a_add
		 From attendance
		 Union
		 Select q_title, q_num, q_sdate, q_edate, q_point, null As a_add
		 From Quiz
		 Order by a_num
		 ) a
        Where a.a_num Like '%#{a_num}%'
         and
         a.a_title Like '%#{a_title}%'
		Order by rn DESC
        ]]>
	</select>
</mapper>